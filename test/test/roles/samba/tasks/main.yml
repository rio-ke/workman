---
- name: install packages
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - "{{ samba_packages }}"

- name: samba Main Configuration
  copy:
    src: /etc/samba/smb.conf
    dest: /etc/samba/smb.Conf_original_backup
    remote_src: yes

- name: Create user
  user:
    name: "{{item}}"
    state: present
    shell: /bin/false
  with_items:
    - "{{samba_users}}"
  register: user_list

- name: To create directory
  file:
    path: "{{item}}"
    state: directory
    owner: jino
    group: jino
  with_items: "{{samba_share_path}}"

- name: Create samba users
  shell: >
    (pdbedit --user={{ item }} 2>&1 > /dev/null)  || (echo {{item}}; echo {{item}}) | smbpasswd -s -a {{item}}
  with_items:
    - "{{samba_users}}"

- name: add template into samba file
  template:
    src: smb.conf.j2
    dest: /etc/samba/smb.conf
    backup: yes
  notify: restart smb

- name: add the line
  lineinfile:
    path: /etc/rsyslog.conf
    backup: yes
    line: local7.*            /var/log/samba.log
  notify: restart rsyslog