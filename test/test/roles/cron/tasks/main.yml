---
- name: "Install cron Packages"
  yum:
    name: cronie
    state: present

- name: "Ensure cron daemon is enabled"
  service:
    name: crond
    enabled: yes
    state: started

- name: "Ensure permissions on /etc/crontab are configured"
  file:
    dest: /etc/crontab
    owner: root
    group: root
    mode: 0600

- name: "Ensure permissions on /etc/cron.hourly are configured"
  file:
    dest: /etc/cron.hourly
    state: directory
    owner: root
    group: root
    mode: 0600

- name: "Ensure permissions on /etc/cron.daily are configured"
  file:
    dest: /etc/cron.daily
    state: directory
    owner: root
    group: root
    mode: 0600

- name: "Ensure permissions on /etc/cron.weekly are configured"
  file:
    dest: /etc/cron.weekly
    state: directory
    owner: root
    group: root
    mode: 0600

- name: "Ensure permissions on /etc/cron.monthly are configured"
  file:
    dest: /etc/cron.monthly
    state: directory
    owner: root
    group: root
    mode: 0600

- name: "Ensure permissions on /etc/cron.d are configured"
  file:
    dest: /etc/cron.d
    state: directory
    owner: root
    group: root
    mode: 0600

- name: "Ensure at/cron is restricted to authorized users"
  file:
    dest: /etc/at.deny
    state: absent

- stat:
    path: "/etc/at.allow"
  register: jino

- name: "Ensure at/cron is restricted to authorized users"
  file:
    dest: /etc/at.allow
    state: '{{ "file" if  jino.stat.exists else "touch"}}'
    owner: root
    group: root
    mode: 0600

- name: "Ensure at/cron is restricted to authorized users"
  file:
    dest: /etc/cron.deny
    state: absent

- stat:
    path: "/etc/cron.allow"
  register: jino

- name: "Ensure at/cron is restricted to authorized users"
  file:
    dest: /etc/cron.allow
    state: '{{ "file" if  jino.stat.exists else "touch"}}'
    owner: root
    group: root
    mode: 0600
