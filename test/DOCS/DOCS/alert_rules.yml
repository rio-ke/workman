groups:
- name: Instances
  rules:
  - alert: InstanceDown
    expr: up == 0
    #for: 30s
    labels:
      severity: critical
    annotations:
      description: 'Instance Name: {{ $labels.instance }}  job Name: {{ $labels.job }} has been Down. Immediate Action Required.'
      summary: 'Instance {{ $labels.instance }} down'
   
#  - alert: Disk_warnings
#    expr: min(node_filesystem_free_bytes{fstype!~"rootfs|selinuxfs|autofs|rpc_pipefs|tmpfs|shm|overlay"}/node_filesystem_size_bytes{fstype!~"rootfs|selinuxfs|autofs|rpc_pipefs|tmpfs|shm|overlay"})*100 < 16
#    for: 5m
#    labels:
#      severity: warning
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} has been Filled 50% Disk. Action Required.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}.Kindly clear some space'
#
#  - alert: Disk_Critical
#    expr: min(node_filesystem_free_bytes{fstype!~"rootfs|selinuxfs|autofs|rpc_pipefs|tmpfs|shm|overlay"}/node_filesystem_size_bytes{fstype!~"rootfs|selinuxfs|autofs|rpc_pipefs|tmpfs|shm|overlay"})*100 < 15 
#    for: 5m
#    labels:
#      severity: Critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} has been Filled 50% Disk. Action Required.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#  
#  - alert: Disk_Full_critical
#    expr: sum(avg(node_filesystem_size_bytes{fstype=~"(ext.|xfs|vfat)"}) without (mountpoint)) without (device,fstype) / (1024/1024/1024) < 10
#    for: 5m
#    labels:
#      severity: Critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} has been Filled almost 90% Disk. Action Required.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#
#  - alert: ROOT_Disk
#    expr: 100 - ((node_filesystem_avail_bytes{mountpoint="/",fstype!="rootfs"} * 100) / node_filesystem_size_bytes{mountpoint="/",fstype!="rootfs"}) > 90
#    for: 5m
#    labels:
#      severity: Critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} has been Filled almost 90% Disk. Action Required.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#  
#  - alert: ROOT_Disk
#    expr: 100 - ((node_filesystem_avail_bytes{mountpoint="/",fstype!="rootfs"} * 100) / node_filesystem_size_bytes{mountpoint="/",fstype!="rootfs"}) > 90
#    for: 5m
#    labels:
#      severity: Warnings
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} has been Filled almost 60% Disk. Action Required.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#
  - alert: AlertmanagerNotificationsFailing
    expr: rate(prometheus_notifications_alertmanagers_discovered[1m]) > 0
    labels:
      service: alertmanager
      severity: critical
    annotations:
      description: Alertmanager is seeing errors for integration {{$labels.integration}}

#  - alert: Login Alert
#    expr: sum(node_logind_sessions) > 0
#    labels:
#      service: Login Success
#      severity: critical
#    annotations:
#      description: 'Instance {{ $labels.instance }}. and (current value is: {{ $value }})'
#  
#  - alert: Establish_connection_high
#    expr: node_tcp_connection_states{state="established"} > 200
#    for: 2m
#    labels:
#      severity: Warnings
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} Establish connection is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Action required.'
#
#  - alert: Establish_connection_high_too
#    expr: node_tcp_connection_states{state="established"} > 250
#    for: 1m
#    labels:
#      severity: critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} Establish connection is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#  - alert: Time_Wait_connection
#    expr: node_tcp_connection_states{state="time_wait"} > 450
#    for: 2m
#    labels:
#      severity: Warnings
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} TIME_WAIT connection is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Action required.'
#
#  - alert: Tcp_connection_high_too
#    expr: node_tcp_connection_states{state="time_wait"} > 650
#    for: 1m
#    labels:
#      severity: critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} TIME_WAIT connection is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#  
#  - alert: context_switches_high
#    expr: rate(node_context_switches_total[5m]) > 15000
#    for: 5m
#    labels:
#      severity: Warnings
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} context_switches_high is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Action required.'
#
#  - alert: Context Switches per Virtual CPU
#    expr: (rate(node_context_switches_total[1m]) or irate(node_context_switches_total[5m])) / scalar(count(node_cpu_seconds_total{mode="user"})) > 650
#    for: 5m
#    labels:
#      severity: critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} Context Switches Per Virtual_CPU is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#  
#  - alert: Load_Average_High
#    expr: node_load1 > 5 or node_load1 > 10 or node_load15 > 20
#    for: 2m
#    labels:
#      severity: critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} Average Load time is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
#  
#  - alert: Load_CPU_High
#    expr: node_cpu_seconds_total > 800000
#    for: 2m
#    labels:
#      severity: critical
#    annotations:
#      description: 'Instance Name: {{ $labels.instance }} CPU Load time is high.(current value is: {{ $value }})'
#      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'
  
  - alert: Swap_Usage_High
    expr: node_memory_SwapFree_bytes / (1024*1024*1024) < 4
    for: 2m
    labels:
      severity: critical
    annotations:
      description: 'Instance Name: {{ $labels.instance }} Swap_Usage is high.(current value is: {{ $value }})'
      summary: 'Instance {{ $labels.instance }}. Immidiate Action required.'



#    expr: avg_over_time(node_procs_blocked{instance=~"$server"}[5m]) > 4
#    for: 2m
#    labels:
#      severity: "warning"
#    annotations:
#      summary: "{{$labels.instance}}: IO-Load is getting high"
#      description: "{{$labels.instance}}: IO-Load usage usage is above  (current value is: {{ $value }})"
  
##  - alert: Node_MemUsage_warning
#    expr: ((node_memory_MemTotal_bytes - node_memory_MemFree_bytes)  / (node_memory_MemTotal_bytes)) * 100 > 50
#    for: 2m
#    labels:
#      severity: "warning" 
#    annotations:
#      summary: "{{$labels.instance}}: Mem usage detected"
#      description: "{{$labels.instance}}: Memory usage is above 50% (current value is: {{ $value }})"
#
#  - alert: Down HTTP Service
#    expr: node_systemd_unit_state{name="httpd.service",state="active"} == 0
#    for: 30s
#    labels:
#      severity: "critical"
#      job: Web-Service
#    annotations:
#      summary: "{{$labels.instance}}: Webservice service Failed"
#      description: "{{$labels.instance}}: webservice Service Failed: {{ $value }})"
#

#  - alert: DailyTest
#    expr: vector(1) > 0
#    for: 1m
#    labels:
#      job: dailytest
#    annotations:
#      summary: "daily alert test"
#      description: "daily alert test"


  - alert: CPU_Threshold_Exceeded
    expr: (100 * (1 - avg by(instance)(irate(node_cpu{mode='idle'}[1h])))) > 90
    for: 1h
    labels:
      severity: "critical"
    annotations:
      summary: "Instance {{ $labels.instance }} CPU usage is dangerously high"
      description: "This device's CPU usage has exceeded the thresold of 90% with a value of {{ $value }} for 1 hour."


  - alert: Instance_Low_Memory
    expr:  node_memory_MemAvailable < 268435456
    for: 10m
    labels:
      severity: "critical"
    annotations:
      summary: "Instance {{ $labels.instance }}: memory low "
      description:  "{{$labels.instance}} has less than 256M memory available"


  - alert: Disk_USAGE_Thresold_Exceeded
    expr:  node_filesystem_free{fstype!~"rootfs|tmpfs|fuse.lxcfs"} / node_filesystem_size{fstype!~"rootfs|tmpfs|fuse.lxcfs"} < 0.10
    for: 15m
    labels:
      severity: "warning"
    annotations:
      summary: "Instance {{$labels.instance}}: disk {{$labels.instance}} filling up"
      description: "{{$labels.device}} mounted on {{$labels.mountpoint}} on {{$labels.instance}} is 90% filled."
 


#  - alert: Disk_Will_Fill_In_2_Hours
#    expr:  predict_linear(node_filesystem_free{fstype!~"rootfs|tmpfs|fuse.lxcfs"}[1h], 2*3600)
#    for: 20m
#    labels:
#      severity: "warning"
#    annotations:
#      summary: "Instance {{$labels.instance}}: disk {{$labels.device}} filling up"
#      description: "{{$labels.device}} mounted on {{$labels.mountpoint}} on {{$labels.instance}} will fill up within 2 hours."

  
  - alert: Site_DOWN
    expr: probe_success < 1
    for: 1m
    labels:
      severity: "websiteDown"
    annotations:
      summary: "{{$labels.instance}} is down"
      description: "site {{$labels.instance}} is down/unreachable."
 
  - alert: Blackbox_Exporter_Down
    expr: count(up{job="blackbox"} == 1) < 1
    for: 1m
    labels:
      severity: "warning"
    annotations:
      summary: "blackbox_exporter is not up"
      description: "blackbox_exporter is not up for 1min."
